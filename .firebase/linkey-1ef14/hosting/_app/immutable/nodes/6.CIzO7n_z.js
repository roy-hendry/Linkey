import{s as H,k as M,e as v,a as P,c as C,m as F,g as q,b as I,f as _,o as g,u as A,i as U,h as p,v as D,q as j,w as W,x as Z,t as w,d as y,j as B}from"../chunks/scheduler.BJHXs0pQ.js";import{S as G,i as J,c as K,a as Q,m as X,t as Y,b as $,d as x}from"../chunks/index.DitbgsN3.js";import{A as ee}from"../chunks/AuthCheck.CQmiWQ5P.js";import{a as te,h as z,j as se,w as le,i as R}from"../chunks/firebase.DQ-78Fzk.js";function N(s){let e,i,l,n;return{c(){e=v("p"),i=w("Checking availability of @"),l=w(s[0]),n=w("..."),this.h()},l(t){e=C(t,"P",{class:!0});var r=I(e);i=y(r,"Checking availability of @"),l=y(r,s[0]),n=y(r,"..."),r.forEach(_),this.h()},h(){g(e,"class","text-secondary")},m(t,r){U(t,e,r),p(e,i),p(e,l),p(e,n)},p(t,r){r&1&&B(l,t[0])},d(t){t&&_(e)}}}function O(s){let e,i="must be 3-16 characters long, alphanumeric only";return{c(){e=v("p"),e.textContent=i,this.h()},l(l){e=C(l,"P",{class:!0,"data-svelte-h":!0}),F(e)!=="svelte-zmkcp1"&&(e.textContent=i),this.h()},h(){g(e,"class","text-error text-sm")},m(l,n){U(l,e,n)},d(l){l&&_(e)}}}function S(s){let e,i,l,n;return{c(){e=v("p"),i=w("@"),l=w(s[0]),n=w(" is not available"),this.h()},l(t){e=C(t,"P",{class:!0});var r=I(e);i=y(r,"@"),l=y(r,s[0]),n=y(r," is not available"),r.forEach(_),this.h()},h(){g(e,"class","text-warning text-sm")},m(t,r){U(t,e,r),p(e,i),p(e,l),p(e,n)},p(t,r){r&1&&B(l,t[0])},d(t){t&&_(e)}}}function V(s){let e,i,l;return{c(){e=v("button"),i=w("Confirm username @"),l=w(s[0]),this.h()},l(n){e=C(n,"BUTTON",{class:!0});var t=I(e);i=y(t,"Confirm username @"),l=y(t,s[0]),t.forEach(_),this.h()},h(){g(e,"class","btn btn-success")},m(n,t){U(n,e,t),p(e,i),p(e,l)},p(n,t){t&1&&B(l,n[0])},d(n){n&&_(e)}}}function ne(s){let e,i="Username",l,n,t,r,o,b,d,T,E,L,f=s[1]&&N(s),u=!s[3]&&s[5]&&O(),c=s[3]&&!s[2]&&!s[1]&&S(s),m=s[3]&&s[2]&&!s[1]&&V(s);return{c(){e=v("h2"),e.textContent=i,l=P(),n=v("form"),t=v("input"),r=P(),o=v("div"),f&&f.c(),b=P(),u&&u.c(),d=P(),c&&c.c(),T=P(),m&&m.c(),this.h()},l(a){e=C(a,"H2",{"data-svelte-h":!0}),F(e)!=="svelte-h7fq4i"&&(e.textContent=i),l=q(a),n=C(a,"FORM",{class:!0});var h=I(n);t=C(h,"INPUT",{type:!0,placeholder:!0,class:!0}),r=q(h),o=C(h,"DIV",{class:!0});var k=I(o);f&&f.l(k),b=q(k),u&&u.l(k),d=q(k),c&&c.l(k),T=q(k),m&&m.l(k),k.forEach(_),h.forEach(_),this.h()},h(){g(t,"type","text"),g(t,"placeholder","Username"),g(t,"class","input w-full"),A(t,"input-error",!s[3]&&s[5]),A(t,"input-warning",s[4]),A(t,"input-success",s[2]&&s[3]&&!s[1]),g(o,"class","my-4 min-h-16 px-8 w-full"),g(n,"class","w-2/5")},m(a,h){U(a,e,h),U(a,l,h),U(a,n,h),p(n,t),D(t,s[0]),p(n,r),p(n,o),f&&f.m(o,null),p(o,b),u&&u.m(o,null),p(o,d),c&&c.m(o,null),p(o,T),m&&m.m(o,null),E||(L=[j(t,"input",s[8]),j(t,"input",s[6]),j(n,"submit",W(s[7]))],E=!0)},p(a,h){h&1&&t.value!==a[0]&&D(t,a[0]),h&40&&A(t,"input-error",!a[3]&&a[5]),h&16&&A(t,"input-warning",a[4]),h&14&&A(t,"input-success",a[2]&&a[3]&&!a[1]),a[1]?f?f.p(a,h):(f=N(a),f.c(),f.m(o,b)):f&&(f.d(1),f=null),!a[3]&&a[5]?u||(u=O(),u.c(),u.m(o,d)):u&&(u.d(1),u=null),a[3]&&!a[2]&&!a[1]?c?c.p(a,h):(c=S(a),c.c(),c.m(o,T)):c&&(c.d(1),c=null),a[3]&&a[2]&&!a[1]?m?m.p(a,h):(m=V(a),m.c(),m.m(o,null)):m&&(m.d(1),m=null)},d(a){a&&(_(e),_(l),_(n)),f&&f.d(),u&&u.d(),c&&c.d(),m&&m.d(),E=!1,Z(L)}}}function ie(s){let e,i;return e=new ee({props:{$$slots:{default:[ne]},$$scope:{ctx:s}}}),{c(){K(e.$$.fragment)},l(l){Q(e.$$.fragment,l)},m(l,n){X(e,l,n),i=!0},p(l,[n]){const t={};n&2111&&(t.$$scope={dirty:n,ctx:l}),e.$set(t)},i(l){i||(Y(e.$$.fragment,l),i=!0)},o(l){$(e.$$.fragment,l),i=!1},d(l){x(e,l)}}}const ae=/^(?=[a-zA-Z0-9._]{3,16}$)(?!.*[_.]{2})[^_.].*[^_.]$/;function oe(s,e,i){let l,n,t,r;M(s,te,u=>i(10,r=u));let o="",b=!1,d=!1,T;async function E(){i(2,d=!1),clearTimeout(T),i(1,b=!0),T=setTimeout(async()=>{console.log("Checking availability of",o);const u=z(R,"usernames",o),c=await se(u).then(m=>m.exists());i(2,d=!c),i(1,b=!1)},500)}async function L(){console.log("Confirming username",o);const u=le(R);u.set(z(R,"usernames",o),{uid:r==null?void 0:r.uid}),u.set(z(R,"users",r.uid),{username:o,photoURL:(r==null?void 0:r.photoURL)??null,published:!0,bio:"I am the Walrus",links:[{title:"Test Link",url:"https://kung.foo",icon:"custom"}]}),await u.commit(),i(0,o=""),i(2,d=!1)}function f(){o=this.value,i(0,o)}return s.$$.update=()=>{s.$$.dirty&1&&i(3,l=(o==null?void 0:o.length)>2&&o.length<16&&ae.test(o)),s.$$.dirty&1&&i(5,n=o.length>0),s.$$.dirty&14&&i(4,t=l&&!d&&!b)},[o,b,d,l,t,n,E,L,f]}class me extends G{constructor(e){super(),J(this,e,oe,ie,H,{})}}export{me as component};
